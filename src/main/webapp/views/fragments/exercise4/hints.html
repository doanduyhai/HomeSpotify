<div class="row">
    <h3>Some hints if you're stuck</h3>
    <tabset>
        <tab heading="Scala">
<pre><code class="scala">
val sc = buildSparkContext(EXERCISE_4)

/*
 * CREATE TABLE IF NOT EXISTS performers (
 *   name TEXT,
 *   ...
 *   country TEXT,
 *   ...,
 *   PRIMARY KEY(name)
 * );
 *
 *
 * CREATE TABLE IF NOT EXISTS albums (
 *   ...
 *   year INT,
 *   performer TEXT,
 *   ...,
 * );
 */
val performers:RDD[(String,String)] = sc.cassandraTable(KEYSPACE, PERFORMERS)
    .select("name","country")
    .as((_:String,_:String))
    //TODO Filter out null countries or "Unknown" countries
    .filter{ case(_,???) => ??? != null && ??? != "Unknown"}

val albums:RDD[(String,Int)] = sc.cassandraTable(KEYSPACE, ALBUMS)
    .select("performer","year")
    .as((_:String,_:Int))
    //TODO Only takes years >= 1900
    .filter{case(_,???) => ??? >= 1900}


//Join performers with albums
val join: RDD[(String, (String, Int))] = performers.join(albums)

join
    //RDD into a ((decade,country),1) using the computeDecade() pre-defined function
    .map { case(performer,(country,year)) => ((computeDecade(???),???),???) }
    //Reduce by key to count the number of occurrence for each key (decade,country)
    .reduceByKey{case(???,???) => ???+???}
    //Flatten the tuple to (decade,country,count) triplet
    .map { case((decade,country),count) => (???,??,???)}
    .saveToCassandra(KEYSPACE, ALBUMS_BY_DECADE_AND_COUNTRY, SomeColumns("decade","country","album_count"))

</code></pre>
        </tab>
        <tab heading="Java 8">
<pre><code class="java">
JavaSparkContext sc = buildSparkContext(EXERCISE_4);

/*
 * CREATE TABLE IF NOT EXISTS performers (
 *   name TEXT,
 *   ...
 *   country TEXT,
 *   ...,
 *   PRIMARY KEY(name)
 * );
 *
 *
 * CREATE TABLE IF NOT EXISTS albums (
 *   ...
 *   year INT,
 *   performer TEXT,
 *   ...,
 * );
 */
JavaPairRDD&lt;String, String&gt; performers = javaFunctions(sc)
    .cassandraTable(KEYSPACE, PERFORMERS)
    .select("name", "country")
    .filter(row -> {
        String country = row.getString("country");
        return country != null && !country.equals("Unknown");
    })
    .mapToPair(row -> new Tuple2(row.getString("name"), row.getString("country")));

JavaPairRDD&lt;String, Integer&gt; albums = javaFunctions(sc)
    .cassandraTable(KEYSPACE, ALBUMS)
    .select("performer", "year")
    .filter(row -> row.getInt("year") &gt;= 1900)
    .mapToPair(row -> new Tuple2(row.getString("performer"), row.getInt("year")));


//TODO Join performers with albums
final JavaPairRDD&lt;String, Tuple2&lt;String, Integer&gt;&gt; joins = performers.join(???);


final JavaRDD&lt;AlbumByDecadeAndCountry&gt; result = joins
    //TODO Map RDD into a ((decade,country),1) using the computeDecade() pre-defined function
    .mapToPair(join -> new Tuple2&lt;&gt;(new Tuple2&lt;&gt;(computeDecade(join._2().???), join._2().???), 1))
    //TODO Reduce by key to count the number of occurrence for each key (decade,country)
    .reduceByKey((left, right) -> ??? + ???)
    //TODO Map the tuple into AlbumByDecadeAndCountry POJO
    .map(grouped -> new AlbumByDecadeAndCountry(grouped._1().???, grouped._1().???, grouped.???));

// Save back to Cassandra
javaFunctions(result)
    .writerBuilder(KEYSPACE, ALBUMS_BY_DECADE_AND_COUNTRY, mapToRow(AlbumByDecadeAndCountry.class))
    .saveToCassandra();

</code></pre>
        </tab>
    </tabset>

</div>